---
# yamllint disable rule:line-length
- name: Get changes in sentinel.conf  # noqa no-changed-when
  ansible.builtin.command: awk '/# Generated by CONFIG REWRITE/{y=1}y' /etc/redis/sentinel.conf
  check_mode: false
  register: __redis_sentinel_trailer

- name: Deploy sentinel template
  ansible.builtin.template:
    src: sentinel.conf.j2
    dest: /etc/redis/sentinel.conf
    mode: "0664"
    owner: redis
    group: redis
    backup: true
  notify: Restart sentinel

- name: Adds sentinel init script
  ansible.builtin.template:
    src: sentinel.init.j2
    dest: /etc/init.d/redis-sentinel
    mode: "0755"
    owner: root
    group: root
  notify: Restart sentinel

- name: Set sentinel to start at boot
  ansible.builtin.service:
    name: redis-sentinel
    enabled: true
